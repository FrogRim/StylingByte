# StylingByte OverView
코디 AI의 기초 알고리즘 및 모델링 구현
현재 세계에 있는 추천 시스템 산업 중 코디 AI와 가장 유사한 상황과 목적을 가진 추천 시스템 모델을 찾았고, 우리는 Youtube의 추천시스템을 선정했다. 그 이유는 Youtube는 수많은 사용자에게 끊임없이 증가하는 동영상을 개인화 맞춤형으로 추천해야 한다. 이것을 옷에 대입하면 끊임없이 새로 디자인되는 옷들도 추가해서 개인화 맞춤형으로 추천해야 하는 코디AI와 유사하였기 때문이다. 그래서 우리는 Youtube의 초기 추천 딥러닝 모델을 토대로 우리 팀이 이번에 사용할 전체적인 추천시스템 모델을 구상했다.

2016년에 YouTube에서 발표한 DNN for YouTube 논문에 따르면 추천시스템에서의 주요 해결과제는 크게 3가지로 나누어진다.

SCALE : 
 - 큰 규모에 적합한 딥러닝 모델을 만들어야 한다.
- 효율적인 Serving이 필요하다.
- 이전에 제안된 딥러닝 모델은 Small Size에만 적합하다.

FRESHNESS : 

- 사용자의 최근 행동(Action)과 새로 업로드된 콘텐츠에 대해서 즉각적으로 대응해야 한다.
- 기존의 유명한 콘텐츠와 새로운 콘텐츠 간의 균형이 중요하다.

Noise : 
- 사용자의 Historical 한 행동을 예측하기에는 어렵다.
- 사용자로부터 직접적인 Ground Truth를 얻을 수 없어, 함축적인 피드백을 활용해서 모델을 학습해야 한다.
 : 사용자로부터 새로운 콘텐츠에 대한 평점을 물어볼 수는 없다.

요약하자면

**SCALE** : 대규모 데이터 셋을 다루기위한 모델 설계를 해야한다.

**FRESHNESS** : 계속 추가되는 새로운 데이터들에 대한 빠른 대응이 필요하고, 새로운 데이터와 원래있던 데이터들 간의 균형을 유지해야한다.

**Noise**  : 사용자들의 행동을 예측하기 어렵고 직접적인 피드백을 받기 힘들기 때문에 이러한 것들을 고려하여 학습해야한다. 

![image](https://github.com/FrogRim/StylingByte/assets/127326495/badbcdf6-78de-4515-bdb4-6ad945c3e2c9)

기본구성은 2가지의 모델로 구성된다.
 1. Candidate Generation (후보 생성 모델)
 2. Ranking Model      

**Candidate Generation**
 - 사용자의 행동 히스토리(Activity History)를 입력으로 사용한다.
 - Candidate Generation Network는 일종의 Collaborative Filtering(협업 필터링)이라고 할 수 있다.
- 광범위한 개인화된 추천을 제공

**Ranking Model**
- 1단계에서 선별된 후보군 중에 상대적으로 더 중요한 영상을 구별하기 위해선, 높은 Recall 성능이 요구된다. 
   Recall : 실제 정답 중 몇 개를 맞추었나
- 목적에 따른 콘텐츠에 점수를 할당하여 추천 → 점수에 따라서 순위를 매겨 User에게 보인다.

이를 통해 설계한 코디 알고리즘의 OverView는 이렇다.

![image](https://github.com/FrogRim/StylingByte/assets/127326495/05d9fe32-548d-432d-87a8-ab13666e6723)

*(AI코디 알고리즘의 전체 OverView)*

개별적으로 하나씩 살펴보면, 구축해야하는 모델은 사용자 정보 생성 모델, 1차 후보 생성 모델, 최종 후보 선정 모델 이렇게 총 3가지이다. 

우선 사용자 정보 생성 모델을 이용해 사용자 데이터(사진)를 토대로 사용자의 성별, 나이, 얼굴형을 예측한다.<br><br>
그리고 사용자가 입력한 계절이나 원하는 스타일 종류들을 고려하여 1차 후보 생성 모델에 의류데이터를 입력하여 1차적인 추천 리스트 후보들을 선정한다.<br><br>
그리고 앞에서 예측한 사용자 정보와 1차적인 추천리스트들을 최종 후보 선정 모델의 입력으로 받아 최종 추천 후보들을 출력한다.

# 사용자 정보 생성 모델 구현

사용자의 정보를 고려하기 위해 사용자 사진을 받았을 때 성별과 나이, 얼굴형을 예측하기 위한 모델을 구축하기 위한 데이터를 수집했다.<br>
우선 성별과 나이를 예측하기 위한 데이터셋을 찾아본 결과, Kaggle에 공개 된 UTKFace 데이터셋을 사용하기로 했다. UTKFace 데이터셋은 나이, 성별, 인종에 따른 다양한 얼굴 이미지를 포함하는 대규모 데이터셋이다. 내용은 각 얼굴 이미지에는 해당하는 나이, 성별, 인종 정보가 라벨로 제공된다. 이 데이터를 사용한 이유는 다음과 같다.<br><br>
1. 라벨정보: 각 이미지에는 나이, 성별, 인종과 같은 유용한 정보가 라벨로 제공되어 있어 데이터 분석 및 모델 학습에 용이하다.<br><br>
2. 대규모 데이터셋: 수천 개의 이미지로 구성된 대규모 데이터셋으로, 학습에 필요한 충분한 양의 데이터를 제공한다.<br><br>
3. 실제 상황에 부합: 다양한 나이와 인종의 얼굴 이미지가 포함되어 있어 실제 상황에 적합한 모델을 학습할 수 있다. 
이후 얼굴형을 예측하기 위한 데이터셋으로 Kaggle에 공개된 Face Shape DataSet을 사용했다.  Face Shape DataSet은 얼굴 형태에 관련된 데이터셋으로, 얼굴 형태를 다양한 카테고리로 분류한 이미지 데이터를 제공한다. 이 데이터셋의 장점은 다음과 같다.<br>

- 1. 얼굴 형태 분류: 얼굴 형태를 다양한 카테고리로 분류하여 해당하는 얼굴 이미지를 제공하여 얼굴 형태 분류에 유용하다.
- 2. 시각적 정보 제공: 각 이미지에는 해당하는 얼굴 형태의 카테고리 정보가 제공되어 있어 데이터 분석 및 모델 학습에 용이하다.
- 3. 다양한 형태 포함: 다양한 얼굴 형태의 이미지가 포함되어 있어 다양한 얼굴 특징을 학습할 수 있다.

데이터를 불러온 후 받은 사진의 성별과 나이를 예측하기 위해 이미지 형식의 데이터에 적합한 모델로 CNN을 선택했다.
CNN(합성곱 신경망)은 딥러닝에서 주로 이미지 인식 및 패턴 인식에 사용되는 신경망 구조이다.
여러 층으로 구성되어 이미지의 특징을 추출하고 분류하는 데 효과적으로 활용된다.

**1. 합성곱층(Convolutional Layer)**
- CNN의 핵심 구성 요소로, 입력 이미지에서 특징을 추출한다.
- 여러 개의 필터(커널)를 사용하여 입력 이미지에 합성곱을 수행하고, 특정 패턴이나 특징을 감지한다.
- 합성곱 연산을 통해 생성된 특징 맵은 이미지의 공간적 정보를 보존하면서 다양한 특징을 포착한다.

**2. 풀링층(Pooling Layer)**
- 입력 이미지의 공간적 크기를 줄이고 계산량을 감소시킨다.
- 주로 최대 풀링(Max Pooling)이나 평균 풀링(Average Pooling)이 사용된다.

**3. 활성화 함수(Activation Function)**
- 비선형성을 도입하여 신경망이 복잡한 함수를 모델링할 수 있도록 한다.
- ReLU(Rectified Linear Unit) 함수가 주로 사용된다.(입력이 양수인 경우에는 값을 그대로 반환하고 음수인 경우에는 0으로 만든다.)

**4. 완전 연결층(Fully Connected Layer)**
- 위에 과정을 통해 추출된 특징들을 입력으로 받아들여 최종 분류를 수행한다.
- 이 층은 특징들의 비선형 조합을 통해 클래스에 대한 확률 분포를 출력한다.


# File Tree
```bash
├── _data
│   ├── styles.csv -> 의류 정보 데이터 셋  
│   └── user.csv -> 사용자 정보(나이,성별) 데이터 셋
├── json  
│   └── recommended_clothes_with_data.json - ai_cody_result.py의 리턴 값으로 이것을 LoadJsonData.cs 코드를 통해 Unity환경으로 불러옴 
├── model
│   ├── age_model_test.h5 -> utkface_data_age_gender_predict.py 파일을 통해 만들어진 나이 판별 ai모델
│   ├── gender_model_test.h5 -> facerecognition_for_age_gender.py 파일을 통해 만들어진 성별 판별 ai모델
│   └── ncf_model.h5 -> 위에 두 모델을 이용해 얻은 사용자 정보와 의류 정보 데이터 셋을 이용해 NCF를 이용한 추천 딥러닝 모델 구축
├── picture
│   └── test_picture.pmg -> test case input data, 이 사진을 age_model과 gender_model을 통해 사진 속 인물의 성별과 나이 추출 후 알맞는 의류 추천
│   
│   
├── src_python
│   ├── utkface_data_age_gender_predict.py -> CNN을 이용하여 사용자의 사진을 보고 나이를 판별하는 모델
│   ├── facerecognition_for_age_gender.py -> CNN을 이용하여 사용자의 사진을 보고 성별을 판별하는 모델
│   └── ai_cody_result.py ->  NFC구현 모델, 그리고 그 후 한 번 더 협업 필터링을 통해 상위 3개의 추천모델 필터링하고 그 결과값을 JSON파일로 반환한다.
├── src_unity
│   ├── LoadJsonData.cs -> json파일의 형식을 규정한 class를 포함하며, 받은 json안의 data들을 읽어 class로 변환시킨 뒤, 유니티 로그에 출력
│   └── PythonRunner.cs -> UNITY환경에서 LOCAL에 세팅된 파이썬 Process를 실행시켜 pyrhon코드들을 전부 실행시킨 뒤, LoadJsonData.cs를 호출해 그 결과값을 Unity 프로세스로 가져온다.
│   
└── 
``` 
